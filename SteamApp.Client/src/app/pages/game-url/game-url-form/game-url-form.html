<form [formGroup]="form" (ngSubmit)="onSubmit()" class="general-form">
  <h2>{{ isEditMode ? 'Edit Game URL' : 'Create Game URL' }}</h2>

  <div class="form-group">
    <label>Game *</label>
    <select formControlName="gameId" class="px-2 py-1">
      <option ngValue="" disabled>Select a game</option>
      @for (game of games(); track game.id){
      <option [ngValue]="game.id">
        {{ game.name }}
      </option>
      }
    </select>
  </div>

  <div class="form-group">
    <label>Name *</label>
    <input formControlName="name" class="px-2 py-1 w-1/2" placeholder="Special Item" />
  </div>

  <div class="form-group">
    <label>URL *</label>
    <input formControlName="partialUrl" class="px-2 py-1 w-full" placeholder="/market/listings/..." />
  </div>

  <div class="form-group-row checkbox-group">
    @if (!isPublicApi())
    {
    <label>
      <input type="checkbox" formControlName="isBatchUrl" />
      Batch URL
    </label>
    <label>
      <input type="checkbox" formControlName="isPixelScrape" />
      Pixel Scrape
    </label>
    }
    <label>
      <input type="checkbox" formControlName="isPublicApi" />
      Public API
    </label>
  </div>

  @if (isBatchUrl()) {
  <div class="form-group">
    <label>Start Page</label>
    <input type="number" formControlName="startPage" class="px-2 py-1" />
  </div>

  <div class="form-group">
    <label>End Page</label>
    <input type="number" formControlName="endPage" class="px-2 py-1" />
  </div>
  }

  @if (isPixelScrape()) {
  <div class="form-group">
    <label>Pixel X</label>
    <input type="number" formControlName="pixelX" class="px-2 py-1" />
  </div>

  <div class="form-group">
    <label>Pixel Y</label>
    <input type="number" formControlName="pixelY" class="px-2 py-1" />
  </div>

  <div class="form-group">
    <label>Image Width</label>
    <input type="number" formControlName="pixelImageWidth" class="px-2 py-1" />
  </div>

  <div class="form-group">
    <label>Image Height</label>
    <input type="number" formControlName="pixelImageHeight" class="px-2 py-1" />
  </div>
  }

  <div class="relation-section">
    <h3>Products for this Game URL</h3>
    @if (filteredProducts.length === 0)
    {
      <p class="relation-empty">No products available for this game.</p>
    }
    @else {
      <label class="relation-select-all">
        <input
          type="checkbox"
          [checked]="areAllFilteredProductsSelected"
          [indeterminate]="areSomeFilteredProductsSelected"
          (change)="toggleAllProducts($any($event.target).checked)"
        />
        Select all products
      </label>

      <div class="relation-grid">
        @for (product of filteredProducts; track product.id)
        {
          <label>
            <input
              type="checkbox"
              [checked]="isProductSelected(product.id)"
              (change)="toggleProduct(product.id, $any($event.target).checked)"
            />
            {{ product.name || 'Unnamed product' }}
          </label>
        }
      </div>
    }
  </div>

  <div class="relation-section">
    <h3>Pixels for this Game URL</h3>
    @if (filteredPixels.length === 0)
    {
      <p class="relation-empty">No pixels available for this game.</p>
    }
    @else {
      <label class="relation-select-all">
        <input
          type="checkbox"
          [checked]="areAllFilteredPixelsSelected"
          [indeterminate]="areSomeFilteredPixelsSelected"
          (change)="toggleAllPixels($any($event.target).checked)"
        />
        Select all pixels
      </label>

      <div class="relation-grid">
        @for (pixel of filteredPixels; track pixel.id)
        {
          <label>
            <input
              type="checkbox"
              [checked]="isPixelSelected(pixel.id)"
              (change)="togglePixel(pixel.id, $any($event.target).checked)"
            />
            {{ pixel.name }}
          </label>
        }
      </div>
    }
  </div>

  <div class="flex gap-x-2">
    <button type="submit" [disabled]="form.invalid">
      {{ isEditMode ? 'Save' : 'Create' }}
    </button>

    <button type="button" (click)="cancel()">Back</button>
  </div>
</form>

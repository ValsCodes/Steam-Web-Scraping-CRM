<div class="p-4">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-semibold text-gray-500">Products</h2>

    <button class="create-button" (click)="createButtonClicked()">Create</button>
  </div>

  <div class="flex gap-x-5 items-end flex-wrap">
    <div class="flex flex-col">
      <label class="mb-1 font-semibold">Game</label>
      <select class="px-2 py-1" [formControl]="gameIdControl">
        <option [ngValue]="null">All</option>
        @for (g of games(); track g.id) {
          <option [ngValue]="g.id">{{ g.name }}</option>
        }
      </select>
    </div>

    <div class="flex flex-col">
      <label class="mb-1 font-semibold">Product Name</label>
      <input class="px-2 py-1" type="text" placeholder="Filter by name" [formControl]="searchByNameFilterControl" />
    </div>

    <div class="flex flex-col">
      <label class="mb-1 font-semibold">Rating</label>
      <input class="px-2 py-1" type="number" placeholder="Filter by rating" [formControl]="searchByRatingFilterControl" />
    </div>

    <div class="flex flex-col min-w-[220px]">
      <label class="mb-1 font-semibold">Tags</label>
      <select class="px-2 py-1" [formControl]="tagIdControl" [disabled]="gameTagsFilter().length === 0" (change)="onTagSelectedFromSelect()">
        <option [ngValue]="null">Select a tag</option>
        @for (tag of gameTagsFilter(); track tag.id) {
          <option [ngValue]="tag.id">{{ tag.name }}</option>
        }
      </select>
    </div>

    <button (click)="clearFiltersButtonClicked()" class="button button-small-danger">Clear</button>
  </div>

  @if (tagsFilter().length > 0) {
    <div class="flex flex-wrap gap-2 mt-3">
      @for (filter of tagsFilter(); track filter) {
        <div class="flex items-center gap-1 px-2 py-1 rounded-md border border-gray-400">
          <span>{{ filter }}</span>
          <button type="button" (click)="removeFilter(filter)">×</button>
        </div>
      }
    </div>
  }

  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
      <ng-container matColumnDef="gameName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Game</th>
        <td mat-cell *matCellDef="let row">{{ row.gameName || '—' }}</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td mat-cell *matCellDef="let row">{{ row.name || '—' }}</td>
      </ng-container>

      <ng-container matColumnDef="tags">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Tags</th>
        <td mat-cell *matCellDef="let row">{{ row.tags?.join(', ') || '—' }}</td>
      </ng-container>

      <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Rating</th>
        <td mat-cell *matCellDef="let row">{{ row.rating || '—' }}</td>
      </ng-container>

      <ng-container matColumnDef="isActive">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Active</th>
        <td mat-cell *matCellDef="let row"><input type="checkbox" [checked]="row.isActive" disabled /></td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let row" class="flex justify-center gap-x-2 py-2">
          <button class="{{row.isActive === true ? 'delete-button'  : 'edit-button'}}" (click)="activeButtonClicked(row)">
            {{row.isActive === true ? 'Deactivate'  : 'Activate'}}
          </button>

          <button class="edit-button" (click)="editButtonClicked(row.id)" (auxclick)="openInNewTab(row.id)">Edit</button>

          <button class="delete-button" (click)="deleteButtonClicked(row.id)">Delete</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator showFirstLastButtons></mat-paginator>
  </div>
</div>
